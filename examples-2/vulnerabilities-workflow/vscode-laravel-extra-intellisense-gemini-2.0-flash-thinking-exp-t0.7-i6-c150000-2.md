* Vulnerability Name: Command Injection via `phpCommand` setting
* Description:
    1. The `Laravel Extra Intellisense` extension relies on user-configurable settings, specifically `LaravelExtraIntellisense.phpCommand`, to execute PHP code. This setting dictates the command used to run PHP scripts for various features like autocompletion.
    2. The extension uses `child_process.exec` in `helpers.ts` to execute the command specified in `phpCommand`, substituting the `{code}` placeholder with PHP code generated by the extension.
    3. A malicious user can craft a workspace configuration file (`.vscode/settings.json`) and include a malicious `phpCommand`. This crafted command can inject arbitrary shell commands alongside the intended PHP code.
    4. When a victim opens a workspace containing this malicious configuration and the extension attempts to execute PHP code (e.g., for autocompletion), the injected shell commands will be executed on the victim's system.
* Impact:
    - Remote Code Execution (RCE). Successful exploitation allows an attacker to execute arbitrary commands on the victim's system with the same privileges as the VSCode process. This can lead to full system compromise, data theft, malware installation, and other malicious activities.
* Vulnerability Rank: critical
* Currently Implemented Mitigations:
    - None. While the extension attempts to escape double quotes in the PHP code using `code = code.replace(/\"/g, "\\\"");` in `helpers.ts`, this is insufficient to prevent command injection, especially when the user fully controls the base command via `phpCommand`.
* Missing Mitigations:
    - Input validation and sanitization for the `phpCommand` setting are completely missing. The extension should validate the `phpCommand` setting to ensure it only contains a safe PHP execution command and reject or sanitize any potentially malicious input.
    - The extension should avoid using `child_process.exec` with user-provided commands. If shell execution is necessary, consider using `child_process.spawn` with carefully constructed arguments to avoid shell injection vulnerabilities.
    - Implement a warning mechanism to inform users about the security risks of modifying the `phpCommand` setting, especially when opening workspaces from untrusted sources. VSCode workspace trust feature should be leveraged to enhance this warning.
    - Explore alternative, safer methods for executing PHP code within the extension, possibly without relying on external shell commands.
* Preconditions:
    - The victim must open a malicious repository in VSCode that contains a crafted `.vscode/settings.json` file.
    - The malicious `.vscode/settings.json` file must include a specifically crafted `LaravelExtraIntellisense.phpCommand` setting designed for command injection.
    - The `Laravel Extra Intellisense` extension must be installed and activated in the victim's VSCode instance.
    - The extension needs to be triggered to execute PHP code, which happens automatically when opening PHP or Blade files in a Laravel project for features like autocompletion.
* Source Code Analysis:
    1. File: `src/helpers.ts`
    2. Function: `runPhp(code: string, description: string|null = null)`
    3. Line: `let commandTemplate = vscode.workspace.getConfiguration("LaravelExtraIntellisense").get<string>('phpCommand') ?? "php -r \"{code}\"";` - Retrieves the `phpCommand` setting from the workspace configuration. If not set, defaults to `php -r "{code}"`.
    4. Line: `let command = commandTemplate.replace("{code}", code);` - Constructs the command by replacing `{code}` with the provided PHP code.
    5. Line: `cp.exec(command, ...)` - Executes the constructed command using `child_process.exec`.
    6. Vulnerability: The `phpCommand` setting is taken directly from user configuration without any validation or sanitization. This allows an attacker to inject arbitrary shell commands by manipulating the `phpCommand` value. The single quote escaping `code = code.replace(/\"/g, "\\\"");` is insufficient to prevent command injection when the base command itself is user-controlled.
* Security Test Case:
    1. Create a new directory named `malicious-repo`.
    2. Inside `malicious-repo`, create a subdirectory named `.vscode`.
    3. Inside `.vscode`, create a file named `settings.json` with the following content:
        ```json
        {
            "LaravelExtraIntellisense.phpCommand": "php -r '{code}; bash -c \"touch /tmp/rce-vulnerability-triggered\"'"
        }
        ```
    4. Open VSCode and open the `malicious-repo` directory as a workspace.
    5. Create a new PHP file (e.g., `test.php`) in the `malicious-repo` directory with any PHP code, for example: `<?php echo 'test'; ?>`. This is to trigger the extension to execute PHP.
    6. Open the `test.php` file in the editor. This action should trigger the `Laravel Extra Intellisense` extension to run PHP code for features like autocompletion.
    7. After a short delay (to allow the extension to activate and run), check if the file `/tmp/rce-vulnerability-triggered` exists on your system.
    8. If the file `/tmp/rce-vulnerability-triggered` is created, it confirms that the injected command `bash -c "touch /tmp/rce-vulnerability-triggered"` was successfully executed, proving the command injection vulnerability.
