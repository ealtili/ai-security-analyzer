# APPLICATION THREAT MODEL

## ASSETS

1. API Keys: API keys for OpenAI, Anthropic (Claude), Google (Gemini), and Replicate services that are required for the application to function.

2. User Images: Screenshots, mockups, and videos uploaded by users to be converted into code.

3. Generated Code: HTML, CSS, JavaScript, and other code generated by the AI models.

4. Evaluation Data: Benchmark data used to evaluate different AI models' performance.

5. User Interaction History: Record of user inputs, generated code versions, and modifications.

6. Debug Information: Debug artifacts generated during code generation processes.

7. Placeholder Images: Images used in generated code, potentially generated by AI services like DALL-E or Replicate.

8. Video Content: Videos uploaded by users to be converted into code, processed into multiple frames.

9. Screenshot Service API Key: API key for the screenshotone.com service used to capture screenshots of URLs.

## TRUST BOUNDARIES

1. Client-Server Boundary: Separating the React/Vite frontend from the FastAPI backend.

2. Backend-AI Service Providers: Boundary between the backend and third-party AI services (OpenAI, Anthropic, Google, Replicate).

3. Container Boundary: Docker container isolation when deployed using Docker.

4. File System Boundary: Access control for logs, debug information, and evaluation data stored on the local filesystem.

5. Browser Storage Boundary: Local storage for user preferences, API keys, and session data in the browser.

6. Screenshot Service Boundary: Communication between the backend and the screenshotone.com service.

7. Temporary File System Boundary: Temporary storage for video files and extracted frames during video processing.

## DATA FLOWS

1. User Image Upload: User uploads an image from frontend to backend (crosses Client-Server Boundary).

2. Image Processing: Backend processes and potentially resizes images before sending to AI services.

3. AI Service Communication: Backend sends processed images to AI services and receives generated code (crosses Backend-AI Service Providers Boundary).

4. Code Return: Backend returns generated code to frontend (crosses Client-Server Boundary).

5. History Storage: Frontend or backend stores version history of generated code.

6. Image Generation: Backend sends text descriptions to image generation services (DALL-E or Replicate) and receives generated images (crosses Backend-AI Service Providers Boundary).

7. Evaluation Data Flow: When performing evaluations, images flow from storage to AI models, and results are stored for comparison.

8. Configuration Flow: API keys and settings flow from frontend to backend or are loaded from environment variables (crosses Client-Server Boundary).

9. Debug Information Flow: Debug artifacts flow from processing functions to filesystem storage (crosses File System Boundary).

10. Video Processing Flow: Video is uploaded, stored temporarily on disk, processed into frames, and frames are sent to AI services (crosses Temporary File System Boundary and Backend-AI Service Providers Boundary).

11. URL to Screenshot Flow: Backend sends URL to screenshot service and receives screenshot image data (crosses Screenshot Service Boundary).

## APPLICATION THREATS

1. API Key Exposure
   - Description: Unauthorized access to API keys stored in the application.
   - Impact: Financial loss due to unauthorized usage of paid AI services, potential compromise of associated accounts.
   - Affected Component: API key storage in config.py, .env files, browser storage, and keys sent in WebSocket communications.
   - Current Mitigations: Keys are stored in environment variables or .env files, not hardcoded in source code. Users can provide their own keys from the settings dialog.
   - Missing Mitigations: No encryption for API keys in browser storage, potentially vulnerable to XSS attacks. No key rotation mechanism. API keys transmitted in plaintext via WebSocket.
   - Risk Severity: Critical

2. Code Injection via Generated Code
   - Description: Malicious code could be injected into the generated HTML/JS that executes in the user's browser.
   - Impact: Execution of malicious JavaScript, potential session hijacking or other client-side attacks.
   - Affected Component: Code rendering in the frontend, code generation by AI models.
   - Current Mitigations: Limited, relies on AI model safety mechanisms.
   - Missing Mitigations: No content security policy, no sanitization of generated code before rendering.
   - Risk Severity: High

3. Data Leakage via Prompts
   - Description: User screenshots, mockups, or videos could contain sensitive information that gets sent to third-party AI services.
   - Impact: Unauthorized exposure of sensitive user data to AI service providers.
   - Affected Component: prompts/__init__.py, image_processing/utils.py, video/utils.py.
   - Current Mitigations: None apparent.
   - Missing Mitigations: No data filtering or sanitization before sending to AI services, no privacy policy explaining data handling, no redaction of sensitive information in images.
   - Risk Severity: Medium

4. Denial of Service via Resource Exhaustion
   - Description: Processing large images or videos could exhaust server resources.
   - Impact: Service degradation or unavailability.
   - Affected Component: image_processing/utils.py, video/utils.py, video_to_app.py.
   - Current Mitigations: Some image resizing is implemented (for Claude API requirements), video frame extraction is limited to 20 frames maximum.
   - Missing Mitigations: No rate limiting, no resource quotas, no comprehensive input validation for image/video size.
   - Risk Severity: Medium

5. Unauthorized Access to Evaluation Data
   - Description: Attackers could access benchmark data or evaluation results.
   - Impact: Exposure of proprietary evaluation methodology or benchmark data.
   - Affected Component: evals/ directory, evals/runner.py, routes/evals.py.
   - Current Mitigations: None apparent.
   - Missing Mitigations: No access controls on evaluation data, no authentication for accessing evaluation endpoints.
   - Risk Severity: Low

6. Cross-Site Request Forgery
   - Description: Attackers could trick authenticated users into performing unwanted actions.
   - Impact: Unauthorized operations using the victim's credentials.
   - Affected Component: FastAPI routes (routes/*.py).
   - Current Mitigations: None apparent.
   - Missing Mitigations: No CSRF tokens or same-site cookie policies implemented.
   - Risk Severity: Medium

7. Debug Information Exposure
   - Description: Debug artifacts could expose sensitive implementation details.
   - Impact: Information disclosure that aids attackers in finding vulnerabilities.
   - Affected Component: debug/DebugFileWriter.py.
   - Current Mitigations: Debug mode can be disabled via configuration.
   - Missing Mitigations: No sanitization of debug output, no access controls on debug files.
   - Risk Severity: Low

8. Temporary File System Exposure
   - Description: Temporary video files stored during processing could be accessed by unauthorized parties.
   - Impact: Unauthorized access to user video content, potentially containing sensitive information.
   - Affected Component: video/utils.py.
   - Current Mitigations: Files are marked for deletion after processing.
   - Missing Mitigations: No secure deletion, no verification that files are actually deleted, files stored in predictable location (system temp directory).
   - Risk Severity: Medium

9. URL Injection via Screenshot Service
   - Description: Malicious URLs could be sent to the screenshot service, potentially causing server-side request forgery.
   - Impact: Unauthorized access to internal resources through the screenshot service, or causing the service to access malicious sites.
   - Affected Component: routes/screenshot.py.
   - Current Mitigations: None apparent.
   - Missing Mitigations: No validation or sanitization of the URL provided, no restrictions on which domains can be screenshotted.
   - Risk Severity: Medium

10. Websocket Connection Hijacking
    - Description: Unauthorized parties intercepting or manipulating the WebSocket connection.
    - Impact: Man-in-the-middle attacks, data theft, injection of malicious payloads.
    - Affected Component: routes/generate_code.py WebSocket route.
    - Current Mitigations: Custom error codes for WebSocket closure.
    - Missing Mitigations: No authentication for WebSocket connections, no encryption beyond transport layer.
    - Risk Severity: High

# DEPLOYMENT THREAT MODEL

## Possible Deployment Solutions
1. Local development setup
2. Docker-based deployment
3. Hosted commercial service (screenshottocode.com)

For this threat model, I'll focus on the Docker-based deployment as it's the most well-defined in the provided files.

## ASSETS
1. Container Images: Docker images containing the application code and dependencies.
2. Docker Socket: Access to Docker daemon through the socket.
3. Host File System: Portions of the host file system mapped into containers.
4. Environment Variables: Configuration and secrets stored in environment variables.
5. Network Traffic: Communication between containers and external services.
6. Docker Compose Configuration: Settings defining the deployment architecture.

## TRUST BOUNDARIES
1. Container-Host Boundary: Isolation between Docker containers and the host system.
2. Inter-Container Boundary: Isolation between the frontend and backend containers.
3. Network Boundary: Traffic flowing between containers, the host, and external services.
4. Volume Mount Boundary: Shared data between host and containers via volume mounts.
5. Environment Boundary: Environment variables passed from host to containers.

## DEPLOYMENT THREATS

1. Container Escape
   - Description: Attackers could escape container isolation and access the host system.
   - Impact: Unauthorized access to host system resources and data.
   - Affected Component: Docker configuration in Dockerfile and docker-compose.yml.
   - Current Mitigations: Using official base images (python:3.12.3-slim-bullseye, node:22-bullseye-slim).
   - Missing Mitigations: No privilege dropping, container runs as root by default, no seccomp profiles.
   - Risk Severity: High

2. Environment Variable Leakage
   - Description: Sensitive environment variables could be leaked through container inspection or logs.
   - Impact: Exposure of API keys and other secrets.
   - Affected Component: .env file loading in docker-compose.yml.
   - Current Mitigations: Using .env file rather than hardcoding secrets in docker-compose.yml.
   - Missing Mitigations: No secrets management solution, no encryption for environment variables.
   - Risk Severity: Medium

3. Insecure Volume Mounts
   - Description: Overly permissive volume mounts could allow container processes to modify host files.
   - Impact: File system corruption or unauthorized file access on the host.
   - Affected Component: Volume mappings in docker-compose.yml.
   - Current Mitigations: None apparent.
   - Missing Mitigations: No clear volume definitions with appropriate permissions.
   - Risk Severity: Medium

4. Network Exposure
   - Description: Exposing container ports unnecessarily could increase attack surface.
   - Impact: Unauthorized access to services.
   - Affected Component: Port mappings in docker-compose.yml.
   - Current Mitigations: Limited to necessary ports (5173 for frontend, 7001 for backend).
   - Missing Mitigations: No network segmentation, no firewall rules.
   - Risk Severity: Low

5. Dependency-Based Attacks
   - Description: Vulnerabilities in dependencies installed via pip or yarn.
   - Impact: Execution of malicious code during container build or runtime.
   - Affected Component: Package installation in Dockerfiles, poetry.lock, package.json.
   - Current Mitigations: Using specific package versions in poetry.lock.
   - Missing Mitigations: No dependency scanning, no use of --no-cache when installing packages.
   - Risk Severity: Medium

6. Outdated Base Images
   - Description: Using outdated or vulnerable base images.
   - Impact: Inheriting vulnerabilities from base images.
   - Affected Component: FROM directives in Dockerfiles.
   - Current Mitigations: Using slim variants of base images.
   - Missing Mitigations: No image scanning, no specification for image updating process.
   - Risk Severity: Medium

# BUILD THREAT MODEL

## ASSETS
1. Source Code: Application code in the repository.
2. Dependency Files: poetry.lock, pyproject.toml, package.json.
3. Build Configuration: Dockerfiles, docker-compose.yml.
4. CI Environment: Any CI environment settings or secrets.
5. Build Artifacts: Generated Docker images, evaluation results.
6. GitHub Repository Access: Permissions to the repository.

## TRUST BOUNDARIES
1. Developer-Repository Boundary: Separation between developer environments and the shared repository.
2. Repository-CI Boundary: Separation between the repository and any CI build environments.
3. Build-Runtime Boundary: Separation between the build process and the runtime environment.
4. Dependency-Source Boundary: Separation between the project code and external dependencies.

## BUILD THREATS

1. Supply Chain Attacks
   - Description: Compromised dependencies could introduce malicious code.
   - Impact: Execution of malicious code during builds or in production.
   - Affected Component: Dependencies in poetry.lock, package.json.
   - Current Mitigations: Lock files ensure consistent versions.
   - Missing Mitigations: No dependency scanning, no signature verification for dependencies.
   - Risk Severity: High

2. Unauthorized Repository Access
   - Description: Unauthorized users gaining write access to the repository.
   - Impact: Introduction of malicious code, data theft.
   - Affected Component: GitHub repository configuration.
   - Current Mitigations: Default GitHub access controls.
   - Missing Mitigations: No branch protection rules visible, no required code reviews.
   - Risk Severity: Medium

3. Insecure Build Practices
   - Description: Build processes that don't verify integrity or authenticity.
   - Impact: Building compromised code.
   - Affected Component: Dockerfiles, any CI configuration.
   - Current Mitigations: None apparent.
   - Missing Mitigations: No integrity checking of source code, no build signing.
   - Risk Severity: Medium

4. Secret Leakage in Builds
   - Description: Secrets could be embedded in build artifacts.
   - Impact: Exposure of API keys and other sensitive data.
   - Affected Component: Docker build process.
   - Current Mitigations: Using .env files outside of container images.
   - Missing Mitigations: No scanning for secrets in code or build artifacts.
   - Risk Severity: Medium

5. Compromised Build Environment
   - Description: Build environments could be compromised to alter artifacts.
   - Impact: Distribution of malicious code to users.
   - Affected Component: Local build environment, potential CI environments.
   - Current Mitigations: None apparent.
   - Missing Mitigations: No reproducible builds, no build attestation.
   - Risk Severity: Medium

6. Dependency Confusion Attack
   - Description: Attackers could publish malicious packages with names similar to internal dependencies.
   - Impact: Incorporation of malicious dependencies during builds.
   - Affected Component: poetry install, yarn install processes.
   - Current Mitigations: Using lock files for dependency versions.
   - Missing Mitigations: No private package registry, no namespace protection.
   - Risk Severity: Low

## QUESTIONS & ASSUMPTIONS

1. What CI/CD pipeline is being used for this project, if any? The repository contains GitHub issue templates, but no GitHub Actions workflows or other CI configuration was found in this batch of files.

2. Is there any authentication mechanism planned for the application? Currently, it appears to rely solely on API keys for service access.

3. Are there specific data retention policies for user-uploaded images and generated code?

4. What is the intended user base and deployment scale? The hosted version (screenshottocode.com) suggests a commercial service, but the security requirements would differ based on the scale and user base.

5. Are there any compliance requirements (GDPR, CCPA, etc.) that the application needs to meet?

6. Is there a defined incident response process for security issues?

7. What security measures are in place for the screenshot service integration? Is there URL validation or domain allowlisting?

8. How are temporary video files and their extracted frames managed after processing? Is there secure deletion?

9. Assumptions:
   - API keys are managed by individual users rather than centrally managed.
   - The application is primarily designed for developer use rather than end-users.
   - No user authentication is implemented in the open-source version.
   - The project doesn't handle personally identifiable information intentionally, although screenshots might contain sensitive data.
   - The application is intended for non-critical use cases (design prototyping, development assistance).
   - Video processing is done locally rather than through a third-party service.
   - The screenshot service is a trusted third-party service.
