# APPLICATION THREAT MODEL

## ASSETS

- API Gateway (Kong): Acts as the entry point for Meal Planner applications. It is responsible for authenticating clients, filtering input, and enforcing rate limiting.
- Web Control Plane: A Golang application deployed on AWS Elastic Container Service that onboards and manages clients, performs system configuration, and checks billing data.
- Control Plane Database: An Amazon RDS instance that stores critical data related to tenants, billing, and overall configuration.
- API Application: A Golang application deployed on AWS Elastic Container Service that provides the primary AI Nutrition-Pro functionality via API.
- API Database: An Amazon RDS instance that stores dietitian content samples as well as requests and responses exchanged with the LLM.
- Administrator Account and Interface: The administrative access point used to configure and manage the AI Nutrition-Pro application.
- Meal Planner Application (external): An external web application that integrates with AI Nutrition-Pro to upload dietitian content and retrieve AI-generated results.
- ChatGPT-3.5 (external): An external LLM system used by the API Application to generate AI-assisted content.

## TRUST BOUNDARIES

- Between external Meal Planner applications (untrusted external entities) and the internal API Gateway.
- Between the API Gateway and the API Application over internal network segments.
- Between the internal API Application and the external ChatGPT service via HTTPS.
- Between the Administrator (trusted user) and the Web Control Plane.
- Between internal application components and the managed RDS databases (data access boundary).

## DATA FLOWS

- Meal Planner Application -> API Gateway: REST/HTTPS communication (crosses the external-to-internal trust boundary).
- API Gateway -> API Application: REST/HTTPS calls within the internal container environment.
- API Application -> ChatGPT-3.5: REST/HTTPS communication, crossing the internal-to-external boundary.
- Web Control Plane -> Control Plane Database: Secured read/write operations over TLS.
- API Application -> API Database: Secured read/write operations over TLS.

## APPLICATION THREATS

| THREAT ID | COMPONENT NAME                     | THREAT NAME                                                                                 | STRIDE CATEGORY       | WHY APPLICABLE                                                                                                                                             | HOW MITIGATED                                                                                           | MITIGATION                                                                                                                                         | LIKELIHOOD EXPLANATION                                                                                        | IMPACT EXPLANATION                                                                                         | RISK SEVERITY |
|-----------|------------------------------------|---------------------------------------------------------------------------------------------|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|---------------|
| 0001      | API Gateway                        | Impersonation of Meal Planner applications via API key spoofing                             | Spoofing              | API Gateway relies on API keys and ACL rules for authentication and authorization. A compromised key could allow an attacker to impersonate a legitimate client. | Uses API keys and TLS encryption to secure communication.                                             | Enhance API key management with periodic rotation, consider mutual TLS, and implement anomaly detection and monitoring.                              | Moderate likelihood due to the inherent risks associated with API key misuse.                                     | High impact if an attacker gains unauthorized access to internal systems.                                  | High          |
| 0002      | API Gateway                        | Denial of Service via API overload                                                          | Denial of Service     | As the entry point, an overload of requests could overwhelm the API Gateway, leading to service disruption.                                             | Basic rate limiting is enabled.                                                                         | Deploy advanced DoS prevention mechanisms and consider integrating a Web Application Firewall (WAF).                                              | High likelihood given the prevalence of DoS attacks in similar web-facing services.                                  | Severe impact through disruption of service availability.                                                 | Critical      |
| 0003      | Web Control Plane                  | Elevation of Privilege via compromised administrative access                                | Elevation of Privilege| Administrative functions have high privileges. A breach of the admin interface can lead to full system compromise.                                         | Basic authentication is in place; multi-factor authentication details are not specified.                | Implement multi-factor authentication and enforce strict role-based access controls for administrative functions.                                  | Medium likelihood if credentials are compromised.                                                             | High impact due to the potential for complete system control loss.                                          | High          |
| 0004      | API Application                    | Remote Code Injection through unvalidated input tampering                                   | Tampering             | The API Application processes incoming data from external sources. Insufficient input validation may allow injection of malicious code.                   | Preliminary input filtering is performed at the API Gateway level.                                      | Enforce strict input validation and sanitization within the API Application itself to guard against injection attacks.                              | Medium likelihood if validations are incomplete or bypassed.                                                     | Could enable remote code execution or compromise of the service.                                            | High          |
| 0005      | Control Plane Database             | SQL Injection and Data Tampering in control plane data                                        | Tampering             | The Control Plane Database holds sensitive tenant and billing information, making it a target for injection or tampering attacks.                          | Use of TLS-secured connections and potential use of prepared statements.                                | Enforce parameterized queries, conduct regular database security audits, and deploy a Web Application Firewall (WAF) to monitor suspicious activity. | Medium likelihood if application logic does not enforce secure coding practices.                                  | Data integrity and confidentiality may be severely compromised.                                            | High          |
| 0006      | API Database                       | Exposure of dietitian content and LLM logs due to information disclosure vulnerabilities      | Information Disclosure| The API Database contains sensitive content and communication logs related to dietitian data and LLM interactions.                                          | Secured by TLS; however, improper access controls could lead to exposure.                             | Implement stringent access controls, enforce encryption at rest, and utilize continuous monitoring and auditing of database access.                | Medium likelihood due to the sensitivity of the stored data and potential misconfigurations.                      | Sensitive intellectual property and personal data may be leaked, damaging reputation and trust.              | High          |
| 0007      | API Application to ChatGPT Service | Man-in-the-middle attack during communication with ChatGPT                                  | Information Disclosure| The API Application communicates with ChatGPT over external networks. Weak TLS or misconfiguration could allow interception of data.                     | TLS encryption is used for communications.                                                            | Enforce strict certificate validation and consider the implementation of mutual TLS where feasible.                                             | Low to medium likelihood if TLS settings are correctly implemented.                                            | Exposure of sensitive dietary data and query contents can compromise user privacy and data integrity.        | Medium        |
| 0008      | Administrator Interface            | Exposure of administrative credentials leading to unauthorized access                       | Spoofing              | Administrator credentials are a high-value target, and their compromise can lead to full system administration abuse.                                    | Basic authentication is deployed; however, enhanced measures may be lacking.                           | Implement multi-factor authentication and enforce strong password policies along with continuous login monitoring.                                | Medium likelihood due to risks such as phishing and password reuse.                                               | High impact from full system compromise if admin credentials are misused.                                     | High          |

# DEPLOYMENT THREAT MODEL

The deployment architecture is based on AWS ECS along with managed services (Amazon RDS, AWS VPC, etc.).

## ASSETS

- AWS ECS Cluster: Hosts the containers for the API Gateway, Web Control Plane, and API Application.
- Amazon RDS Instances: Host the Control Plane Database and API Database.
- AWS VPC: Provides network segmentation with public and private subnets.
- Load Balancers and Security Groups: Control inbound and outbound traffic.
- IAM Roles and Policies: Define permissions for ECS tasks and other AWS services.
- Container Images and Registries: Store the built container images used in deployment.
- TLS Certificates and AWS Networking Configurations: Secure communications across the deployment environment.

## TRUST BOUNDARIES

- Public Internet to AWS VPC: Boundary enforced by load balancers and security groups separating untrusted external traffic from internal resources.
- Public Subnets to Private Subnets: Segmentation of network resources, ensuring that databases and internal services are not directly exposed.
- Boundaries enforced by security groups and Network ACLs within the VPC.
- Separation between services based on assigned IAM roles and permission sets.

## DEPLOYMENT THREATS

| THREAT ID | COMPONENT NAME                          | THREAT NAME                                                                                  | STRIDE CATEGORY       | WHY APPLICABLE                                                                                                                                              | HOW MITIGATED                                                                                          | MITIGATION                                                                                                                                             | LIKELIHOOD EXPLANATION                                                                                        | IMPACT EXPLANATION                                                                                        | RISK SEVERITY |
|-----------|-----------------------------------------|----------------------------------------------------------------------------------------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|---------------|
| 0001      | AWS ECS Cluster and Security Groups     | Improper security group configuration exposing containers to unauthorized access             | Spoofing              | Misconfigured security groups can allow attackers to bypass network restrictions and access internal container instances directly.                         | Basic security group rules are configured; however, manual errors or oversights can occur.             | Regularly audit security group configurations and enforce the principle of least privilege in network rules.                                         | Moderate likelihood due to the possibility of human misconfiguration.                                         | High impact if internal services become directly accessible to attackers.                             | High          |
| 0002      | Amazon RDS Instances                     | Misconfigured database inbound rules exposing RDS to the public Internet                        | Information Disclosure| Inadvertent exposure of RDS instances could allow unauthorized access to sensitive tenant and billing data.                                                  | RDS instances are typically deployed in private subnets, but misconfigurations remain a risk.         | Ensure RDS instances are deployed exclusively in private subnets and enforce strict inbound access rules via security groups and network ACLs.        | Medium likelihood, dependent on the rigor of deployment practices.                                             | Severe impact due to the potential for data breaches and unauthorized data manipulation.                  | High          |
| 0003      | AWS ECS Container Hosts                  | Compromise of container host due to unpatched vulnerabilities affecting the container runtime   | Tampering             | Vulnerable host configurations can be exploited, leading to compromise of the entire container environment.                                               | Regular patching processes may be in place; however, gaps in patch management can exist.               | Implement automated patch management and continuous monitoring of container host security.                                                          | Moderate likelihood if patching processes are not rigorously enforced.                                          | High impact through potential widespread compromise of hosted services.                                  | High          |
| 0004      | IAM Roles for ECS Tasks                  | Excessive privileges granted to container IAM roles allowing unauthorized actions               | Elevation of Privilege| Overprivileged IAM roles can be exploited to perform unauthorized operations, increasing risk across the deployment.                                        | Default IAM roles may be in use with broader permissions than necessary.                             | Apply the principle of least privilege by reviewing and tightening IAM policies and regularly auditing role permissions.                           | Moderate likelihood if role misconfigurations persist.                                                           | High impact due to potential unauthorized access to AWS resources and sensitive data.                     | High          |

# BUILD THREAT MODEL

## ASSETS

- Source Code Repositories: Contain the application code and configuration files.
- CI/CD Pipeline: Automated build system (e.g., GitHub Actions, Jenkins, or AWS CodeBuild) that builds container images.
- Build Scripts and Configuration Files: Scripts that define the build processes for container images.
- Container Image Registry: Storage location for build artifacts (container images) used in deployment.
- Third-Party Libraries and Dependencies: External packages incorporated into the application during the build process.

## TRUST BOUNDARIES

- Between the Source Code Repository (trusted codebase) and the CI/CD system.
- Between the internal build environment and external dependency repositories.
- Between the build environment and the container image registry (deployment artifacts).

## BUILD THREATS

| THREAT ID | COMPONENT NAME              | THREAT NAME                                                                                                    | STRIDE CATEGORY       | WHY APPLICABLE                                                                                                                                           | HOW MITIGATED                                                                                           | MITIGATION                                                                                                                                           | LIKELIHOOD EXPLANATION                                                                                        | IMPACT EXPLANATION                                                                                        | RISK SEVERITY |
|-----------|-----------------------------|----------------------------------------------------------------------------------------------------------------|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|---------------|
| 0001      | CI/CD Pipeline              | Compromise of the CI/CD pipeline leading to injection of malicious code into build artifacts                   | Tampering             | The CI/CD system is critical for producing deployment artifacts. A compromise here can lead to the insertion of malicious code in production.        | Basic access controls may be in place, but detailed security measures are not specified.             | Enforce strict access controls, continuous monitoring, code signing of build artifacts, and regular security audits of the pipeline.                 | Medium likelihood due to the attractiveness of CI/CD systems as high-value targets.                              | Critical impact if compromised, as malicious code could be widely distributed across deployments.         | High          |
| 0002      | Dependency Management       | Supply chain attack through compromised third-party libraries or dependencies                                   | Tampering             | The build process relies on external dependencies, which may be tampered with or replaced with malicious code if not verified.                          | No explicit mitigation details provided in current documentation.                                    | Use dependency scanning tools, verify package signatures, and maintain a whitelist of approved dependencies.                                      | Medium likelihood given the increasing frequency of supply chain attacks.                                       | High impact as compromised dependencies can affect the security of the entire application.                | High          |
| 0003      | CI/CD Pipeline Secrets      | Exposure of CI/CD credentials and secrets due to insecure storage or misconfiguration                            | Information Disclosure| CI/CD pipelines often require access to critical secrets and credentials; exposure of these can compromise the entire build process.                     | Some CI/CD platforms offer built-in secret management, but proper configuration is essential.         | Utilize secure secret management solutions, restrict access to secrets, and regularly audit the configuration and access logs.                     | Medium likelihood if best practices for secret management are not consistently followed.                       | High impact as exposed credentials can lead to a full compromise of build and deployment processes.       | High          |
| 0004      | Build Server Host           | Compromise of the build server host due to unpatched vulnerabilities in the build environment                     | Tampering             | The build server host is a critical asset that, if compromised due to outdated patches, can allow attackers to alter the build process.                | Regular patch management may be practiced but is not detailed in provided information.                | Enforce strict patch management and continuous vulnerability scanning on the build server hosts.                                                  | Low to medium likelihood if patch management is effective; higher otherwise.                                     | High impact since a compromised build host can lead to persistent malicious modifications in build artifacts. | High          |

# QUESTIONS & ASSUMPTIONS

Questions:
- What specific CI/CD system is being used (e.g., GitHub Actions, Jenkins, AWS CodeBuild)?
- Are container image scanning and registry access controls implemented and monitored?
- What are the detailed hardening measures applied to the AWS ECS cluster and RDS instances?
- How is administrator access further secured beyond basic authentication methods?
- Are there any additional logging, monitoring, or incident response measures in the production environment?

Assumptions:
- TLS is enforced across all network communications between components and during data flows.
- AWS best practices for ECS, RDS, VPC, and IAM configurations are followed.
- Basic security measures such as rate limiting, API key validation, and standard access controls are in place.
- The build process includes at least basic vulnerability scanning and static analysis, even though detailed practices are not specified.
- Regular patch management and system updates are performed for both deployment and build environments.
- The threat model focuses on realistic adversarial scenarios that have a high impact on system confidentiality, integrity, and availability.
- Threats deemed too unlikely may not have extensive controls if the mitigation cost outweighs the potential risk.
