# APPLICATION THREAT MODEL

## ASSETS
- Control Plane Database (control_plan_db) containing tenant data, billing information, and configuration details.
- API Database (api_db) storing dietitians' content samples and LLM (ChatGPT) requests/responses.
- API Gateway, Web Control Plane, and Backend API application code and configuration.
- User credentials (API keys for Meal Planner, Administrator credentials).
- Network communication channels (TLS-encrypted connections).
- AI-generated content and diet-related data flowing through the system.

## TRUST BOUNDARIES
- Meal Planner application (external) to API Gateway (internal).
- Administrator (human) to the Web Control Plane (internal application).
- Web Control Plane to Control Plane Database.
- API Gateway to Backend API.
- Backend API to API Database.
- Backend API to ChatGPT (external).
- Internal ECS environment to external networks (for ChatGPT access).

## DATA FLOWS
1. Meal Planner → API Gateway (HTTPS/REST).
2. API Gateway → Backend API (HTTPS/REST).
3. Backend API → ChatGPT (HTTPS/REST).
4. Administrator → Web Control Plane (HTTPS/REST).
5. Web Control Plane → Control Plane Database (TLS-protected).
6. Backend API → API Database (TLS-protected).

## APPLICATION THREATS

| THREAT ID | COMPONENT NAME      | THREAT NAME                                                                 | STRIDE CATEGORY          | WHY APPLICABLE                                                                                                                      | HOW MITIGATED                                                                                                                  | MITIGATION                                                                                                                                                              | LIKELIHOOD EXPLANATION                                                                                           | IMPACT EXPLANATION                                                                                               | RISK SEVERITY |
|-----------|---------------------|-----------------------------------------------------------------------------|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|--------------|
| T-01      | API Gateway         | Attacker impersonates a Meal Planner application by stealing/guessing API key | Spoofing                 | API Gateway relies on API keys to authenticate clients. If leaked or guessed, an attacker can pose as a legitimate Meal Planner app. | Currently mitigated by unique API keys for each Meal Planner and rate-limiting.                                                                                      | Enforce strong API key complexity, rotate keys regularly, implement IP allowlists or stricter authentication mechanisms.                                                | Medium: Regular key rotation but keys potentially discoverable if stored insecurely by the client app.           | High: Successful spoofing allows full read/write to API.                                                         | High         |
| T-02      | Web Control Plane   | Administrator account takeover via weak password or credential stuffing      | Spoofing                 | The Web Control Plane holds sensitive billing/config data. If an attacker gains admin access, they can manipulate system settings.   | Basic password-based authentication. Likely uses TLS but no detail on password policy.                                                                             | Require MFA for admin, enforce strong password policy, add anomaly detection and account lockout after multiple failed attempts.                                        | Medium: Administrator credentials might be targeted, but some awareness (MFA, etc.) might lower it.              | Critical: Full control over system configuration and billing data.                                                                | High         |
| T-03      | Backend API         | Malicious data tampering in requests from API Gateway to Backend API         | Tampering                | If an attacker bypasses or compromises API Gateway, they could inject or modify requests before reaching Backend API.               | Partially mitigated by API Gateway filtering and validation rules.                                                                                                 | Implement strict input validation in Backend API as well, verify request integrity, enable request signature checks if possible.                                        | Low: Requires also compromising or bypassing API Gateway.                                                                        | Medium: Could lead to inconsistent or corrupted data in API Database and possibly erroneous AI output.            | Medium       |
| T-04      | Web Control Plane   | Inadequate logging leading to repudiation of administrative actions          | Repudiation             | If logs of admin actions are incomplete or tampered with, administrators can deny or hide malicious modifications.                  | Unknown existing logging detail. Possibly limited audit trails.                                                                                                     | Implement robust audit logging for all administrative actions (create, update, delete) along with secure storage of logs (e.g., append-only logging system).             | Medium: Administrators might not be heavily monitored, but partial logs may exist.                                | High: Untraceable modifications of billing, configuration, or user data.                                                          | High         |
| T-05      | API Database        | Sensitive data leakage (dietitian content, requests/responses)              | Information Disclosure   | API Database stores potentially private or proprietary dietitian data. A leak compromises intellectual property and user privacy.   | TLS in transit to the DB; unknown at-rest encryption details.                                                                                                       | Enable encryption at rest for DB, limit DB access to least-privilege roles, utilize data masking for sensitive fields, ensure strong network controls around RDS.         | Medium: Requires DB infiltration or misconfiguration, but external threat actors target DBs frequently.          | High: Exposed health or diet data, reputational damage, and privacy violations.                                                  | High         |
| T-06      | Backend API         | Overloading or flooding the API to deny service to Meal Planner applications | Denial of Service        | Attackers could send massive requests or misuse the LLM endpoints, exhausting resources.                                           | API Gateway has rate-limiting rules. Backend API is presumably scalable in AWS ECS.                                                                                 | Enforce additional throttling, auto-scaling policies, request queue limits, and WAF rules.                                                                             | Medium: System scaling helps but excess cost or targeted resource exhaustion is possible.                         | Medium: Period of downtime or partial outage, harming user trust and business continuity.                                        | Medium       |
| T-07      | Web Control Plane   | Privilege escalation from lower-privileged roles to Administrator            | Elevation of Privilege   | A compromised lower-privilege account may find ways (e.g., parameter tampering) to elevate privileges within the Control Plane.     | Possibly mitigated by role-based access but no details on fine-grained RBAC.                                                                                       | Implement thorough role-based access controls (RBAC), validate server-side checks strictly, and ensure no hidden or direct object references allow escalation.            | Low: Additional steps typically needed to exploit such an escalation, but not impossible.                           | High: Full admin privileges allow management of all clients, billing, and configurations.                                       | High         |
| T-08      | Backend API         | Manipulating requests or responses to ChatGPT for malicious or unintended output | Tampering                | The system depends on ChatGPT responses. An attacker controlling requests to ChatGPT could produce harmful or misleading content.   | Currently, input is filtered by API Gateway, but no mention of deeper content validation in the backend.                                                           | Apply content validation and sanitization before sending to ChatGPT and on responses, add usage monitoring to detect suspicious or extreme requests.                      | Low: Requires attacker to have some level of request injection into the backend.                                                 | Medium: Could produce reputational harm if AI generates harmful or incorrect diet instructions.                                    | Medium       |

---

# DEPLOYMENT THREAT MODEL

Below are possible deployment architectures:
- On-premises deployment in a private data center.
- AWS cloud-based deployment using ECS, RDS, and other AWS services.

We choose the AWS-based deployment for the threat model.

## ASSETS
- AWS Elastic Container Service (ECS) tasks running the Web Control Plane and Backend API.
- Amazon RDS instances holding Control Plane Database and API Database.
- AWS IAM credentials, roles, and policies controlling access to services.
- Networking configuration (VPCs, security groups, load balancers).
- Secrets, such as database credentials, API keys, and encryption keys.

## TRUST BOUNDARIES
- Public internet to VPC boundary through load balancers or API Gateway endpoints.
- ECS tasks to RDS Database boundary (security group rules).
- IAM role-based boundary controlling which ECS tasks or AWS services can access certain AWS resources.

## DEPLOYMENT THREATS

| THREAT ID | COMPONENT NAME                           | THREAT NAME                                                                                                               | WHY APPLICABLE                                                                                                                                   | HOW MITIGATED                                                                                                                       | MITIGATION                                                                                                                                                  | LIKELIHOOD EXPLANATION                                                                                                   | IMPACT EXPLANATION                                                                                          | RISK SEVERITY |
|-----------|------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|--------------|
| D-01      | ECS Tasks (Web Control Plane, Backend)   | Unauthorized access to containers through misconfigured security groups or IAM roles                                      | Containers need to communicate with RDS and other services. Overly permissive security could allow an attacker to pivot inside AWS environment.    | Potentially mitigated by restricting security group ingress and egress and using IAM roles with minimal privileges.                                          | Conduct regular IAM reviews, minimize port exposures, use private subnets, implement network segmentation, monitor container logs for suspicious activity.  | Medium: Requires knowledge of AWS environment but misconfigurations are common.                               | High: Compromised container can lead to full control over data and potentially pivot to other AWS resources.                              | High         |
| D-02      | RDS Databases                           | Misuse of RDS instance via stolen or mismanaged IAM credentials/roles                                                     | If the IAM role or DB credentials are compromised, an attacker can read or delete data from the DB.                                                 | Partially mitigated by restricting RDS connections to only certain security groups and IAM roles.                                                            | Enable AWS Secrets Manager for rotating DB credentials, enforce least privilege roles, monitor DB access logs (e.g., CloudTrail integration if possible).    | Medium: Attackers can target credentials that might be stored in code or environment variables.              | High: Database breach can expose personal info, diet data, or system configurations.                                             | High         |
| D-03      | AWS Networking (VPC, ALB, Gateway)       | Eavesdropping or traffic interception if TLS termination is incorrectly configured or compromised at load balancer level   | Network traffic is considered private, but if ALB or TLS endpoints are not configured properly, attackers could intercept or tamper with traffic.  | Typically mitigated by proper TLS termination at the AWS ALB or API Gateway and restricting internal traffic to private subnets.                            | Periodic configuration reviews, AWS Certificate Manager for certificate rotation, ensure end-to-end encryption beyond the ALB if needed.                   | Low: AWS default configurations are usually secure, though misconfiguration is possible.                        | High: Intercepted traffic could reveal sensitive tokens, keys, or data in transit.                                                   | Medium       |
| D-04      | IAM Policies and Roles                   | Overly permissive IAM role allowing unauthorized changes to infrastructure                                                | If a compromised application role has admin-like privileges, an attacker can alter or delete resources.                                             | Mitigated by principle of least privilege. Typically roles are specific to ECS tasks, but exact policy details unknown.                                       | Continuously audit IAM roles, remove wildcard actions, implement condition keys, and require approvals for changes.                                         | Medium: Complex AWS environments often have small misconfigurations.                                           | High: Could lead to permanent data loss, unauthorized resource creation, and pivot across the cloud environment.                    | High         |
| D-05      | ECS Fargate/ECS Services deployment      | Denial of Service through resource exhaustion (CPU, memory)                                                                | Attackers or misconfigured processes could cause high resource usage, leading to service unavailability.                                           | AWS auto-scaling groups or Fargate can scale out, but might lead to high cost or partial outages if budgets are exceeded.                                    | Monitor resource usage with CloudWatch, set up alerts, enforce request rate-limiting, define scale-out thresholds, and cost-based guardrails.               | Medium: System can auto-scale to an extent, but unbounded requests can still cause disruption.                 | Medium: Service disruption hinders usage for legitimate clients, leading to revenue and reputation loss.                    | Medium       |

---

# BUILD THREAT MODEL

## ASSETS
- Source code repositories containing Golang services (Web Control Plane, Backend API).
- Build pipeline/scripts for containerizing and deploying to AWS ECS.
- Credentials/tokens for CI/CD systems and AWS.
- Build artifacts (Docker images).
- Security scan results and logs.

## TRUST BOUNDARIES
- Developer workstations to source code repository.
- CI/CD pipeline systems to AWS environment (deployment).
- External dependencies (open-source libraries) introduced during build.

## BUILD THREATS

| THREAT ID | COMPONENT NAME | THREAT NAME                                                                 | WHY APPLICABLE                                                                               | HOW MITIGATED                                                                                                                              | MITIGATION                                                                                                                                     | LIKELIHOOD EXPLANATION                                                                                   | IMPACT EXPLANATION                                                                                           | RISK SEVERITY |
|-----------|---------------|-----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|--------------|
| B-01      | Source Code    | Malicious commit or pull request injecting backdoor code                     | Attackers or disgruntled insiders can modify the codebase to include malicious functionality.   | Possibly mitigated by code review practices, but no explicit mention of branch protection or pull request reviews.                          | Enforce mandatory code reviews, implement branch protection rules, enable commit signing, and use automated scanning for known malicious patterns. | Medium: Common threat if open collaboration or large dev team.                                          | High: Infected code would be deployed into production, potentially compromising user data or system integrity. | High         |
| B-02      | CI/CD Pipeline | Stolen build system credentials or tokens leads to unauthorized environment access | Build pipelines typically store secrets for deployment. If exposed, an attacker can deploy malicious versions or access AWS resources. | Partially mitigated if secrets are stored in a secure vault. Details not provided.                                                         | Use a secret manager, rotate tokens frequently, enforce strong access controls on CI/CD pipeline and limit who can retrieve secrets.             | Medium: Pipeline credentials may be less monitored yet have significant privileges.                         | High: Full compromise of build output or direct environment changes.                                          | High         |
| B-03      | Build Artifacts | Supply chain poisoning by downloading compromised dependencies               | Golang modules or other libraries might be compromised. A Trojan library can embed malicious code at build time.                     | Not stated. Possibly mitigated by checksums or at best ephemeral container-based builds.                                                   | Use checksums/SHA verification, rely on official or pinned package versions, implement SBOM scanning, implement dependency vulnerability scanning. | Medium: Attackers increasingly target supply chain dependencies.                                          | High: Infects final application with stealthy malicious code.                                                 | High         |
| B-04      | CI Automation  | Lack of security checks (SAST, linting)                                      | Without code scanning, vulnerabilities may go unnoticed and be shipped to production.          | Possibly not mitigated if no mention of automated scanning.                                                                                | Integrate SAST (e.g., SonarQube) pipelines, static analysis, dependency scanning, and set quality gates that block merges when critical issues are found. | Medium: Very common that vulnerabilities slip in if no scanning.                                           | Medium: Leads to potential unknown vulnerabilities in production.                                            | Medium       |

---

# QUESTIONS & ASSUMPTIONS
- There is an assumption of proper AWS configuration hygiene (security groups, IAM roles) that might not always reflect reality. Would need confirmation of actual AWS configurations.
- It is assumed that TLS is consistently enforced for all internal/external communication, but logs or details of certificate rotation are unknown.
- We assume the Administrator uses a strong password or MFA; if not, risk of admin account compromise rises.
- We lack details on log retention and audit capabilities for both application and infrastructure logs.
- We assume ChatGPT usage adheres to standard API usage policies and no advanced malicious injection is performed on that side.
- We have not seen explicit mentions of encryption at rest in RDS. This is assumed to be enabled but should be verified.
- The build pipeline security is assumed to have minimal controls; in reality, it may have more robust solutions (e.g., GitHub Actions with restricted workflows) that can reduce some threats.

These threats reflect realistic scenarios derived from the provided architecture documentation. The feasibility of certain exploits may vary depending on exact configurations and operational practices.
